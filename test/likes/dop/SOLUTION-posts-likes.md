# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Å—Ç–æ–º –ª–∞–π–∫–∏ - –†–ï–®–ï–ù–ò–ï

## üî¥ –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

–í –æ—à–∏–±–∫–∞—Ö —Ç–µ—Å—Ç–∞ –≤–∏–¥–Ω–æ –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö –æ—Ç–ª–∏—á–∏—è:

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
"myStatus": "Like",
"newestLikes": [{"addedAt": "...", "userId": "...", "login": "..."}]
```

### –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
"myStatus": "None",
"newestLikes": []
```

## üéØ –†–£–® –†–ï–®–ï–ù–ò–Ø

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: **–ö–æ–≥–¥–∞ –≤—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ –ø–æ—Å—Ç—ã —á–µ—Ä–µ–∑ GET /posts –∏–ª–∏ GET /blogs/:blogId/posts, –≤—ã –ù–ï –û–¢–ü–†–ê–í–õ–Ø–ï–¢–ï Bearer —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization!**

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
```typescript
const response = await request(app.getHttpServer())
  .get('/posts')
  // –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞!
  .expect(200);
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
```typescript
const response = await request(app.getHttpServer())
  .get('/posts')
  .set('Authorization', `Bearer ${userToken}`) // ‚Üê –î–û–ë–ê–í–ò–¢–¨ –≠–¢–û!
  .expect(200);
```

## üìã –ß—Ç–æ —ç—Ç–∞ –ø–æ–¥—á–∏—Å—Ç–∫–∞ –¥–µ–ª–∞–µ—Ç:

1. **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: API –∑–Ω–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. **–í—ã—á–∏—Å–ª—è–µ—Ç myStatus**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ª–∞–π–∫–∞–ª –ª–∏ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞–∂–¥—ã–π –ø–æ—Å—Ç
3. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç newestLikes**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –ª–∞–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞

## üîß –ö–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤:
```typescript
const createUser = async (index: number) => {
  const userData = users[index];
  
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  await request(app.getHttpServer())
    .post('/auth/registration')
    .send({...userData})
    .expect(204);

  // –õ–æ–≥–∏–Ω –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  const loginResponse = await request(app.getHttpServer())
    .post('/auth/login')
    .send({...})
    .expect(200);

  const token = loginResponse.body.accessToken;
  userTokens.set(index, token); // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω!
  return { token };
};
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤:
```typescript
const likePost = async (postId: string, userIndex: number, status: 'Like' | 'Dislike' | 'None' = 'Like') => {
  const token = userTokens.get(userIndex); // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
  await request(app.getHttpServer())
    .put(`/posts/${postId}/like-status`)
    .set('Authorization', `Bearer ${token}`) // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
    .send({ likeStatus: status })
    .expect(204);
};
```

### 3. –ó–∞–ø—Ä–æ—Å –ø–æ—Å—Ç–æ–≤ –° –¢–û–ö–ï–ù–û–ú:
```typescript
const getPosts = async (userIndex: number) => {
  const token = userTokens.get(userIndex); // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –¢–ï–ö–£–©–ï–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
  const response = await request(app.getHttpServer())
    .get('/posts')
    .set('Authorization', `Bearer ${token}`) // ‚Üê –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï!
    .expect(200);
    
  return response.body;
};
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç 1: GET -> "/posts"
- –°–æ–∑–¥–∞—ë—Ç 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞—ë—Ç –±–ª–æ–≥
- –°–æ–∑–¥–∞—ë—Ç 6 –ø–æ—Å—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ—Å—Ç—ã **—Å —Ç–æ–∫–µ–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ myStatus –∏ newestLikes –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1

### –¢–µ—Å—Ç 2: GET -> "/blogs/:blogId/posts"
- –î–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç –±–ª–æ–≥–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîç –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:
- ‚úÖ –í—Å–µ –ø–æ—Å—Ç—ã –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `myStatus` (Like, Dislike –∏–ª–∏ None)
- ‚úÖ `newestLikes` –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–º–∏)
- ‚úÖ –ö–∞–∂–¥—ã–π –ª–∞–π–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç userId, login –∏ addedAt
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ
- ‚úÖ –î–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π myStatus –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ç–µ—Å—Ç—ã

1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `posts-likes.e2e-spec.ts` –≤ `test/posts/` –∏–ª–∏ `test/likes/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:
   ```bash
   npm run test:e2e -- posts-likes
   ```

## üìù –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Bearer —Ç–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è myStatus
2. **–ü–æ—Ä—è–¥–æ–∫ –ª–∞–π–∫–æ–≤ –≤–∞–∂–µ–Ω** - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
3. **newestLikes** –æ–±—ã—á–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –ª–∞–π–∫–∞
4. **myStatus** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å—Ç—ã
5. **–î–∏–∑–ª–∞–π–∫–∏** —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ª–∞–π–∫–æ–≤

## üêõ –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –≤—Å—ë –µ—â—ë –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?**
   ```typescript
   @Get()
   getPosts(
     @Query() query: GetPostsQueryDto,
     @CurrentUser() currentUser?: UserInfoDto, // ‚Üê –ù—É–∂–Ω–æ —ç—Ç–æ
   ) {
     // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å currentUser.id –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è myStatus
   }
   ```

2. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ API newestLikes –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ?**
   ```typescript
   extendedLikesInfo: {
     likesCount: number,
     dislikesCount: number,
     myStatus: 'Like' | 'Dislike' | 'None',
     newestLikes: Array<{
       addedAt: string (ISO),
       userId: string,
       login: string
     }>
   }
   ```

3. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ addedAt –≤ —É–±—ã–≤–∞—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ?**
   ```typescript
   newestLikes: likes.sort((a, b) => 
     new Date(b.addedAt).getTime() - new Date(a.addedAt).getTime()
   )
   ```
